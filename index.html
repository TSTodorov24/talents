<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Таланти 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
    --accent1:#ff512f; --accent2:#dd2476; --accentBlue1:#00c6ff; --accentBlue2:#0072ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Montserrat',sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
    color:#fff;
    display:flex; flex-direction:column; align-items:center;
    min-height:100vh; padding:40px 20px; overflow:hidden;
  }
  header{width:100%; max-width:1100px; display:flex; align-items:center; justify-content:space-between; gap:20px; margin-bottom:10px;}
  h1{margin:0; font-size:2.2rem; letter-spacing:.6px; text-shadow:3px 3px 12px rgba(0,0,0,.6);}
  .controls{display:flex; gap:12px; align-items:center;}
  .btn{
    background:linear-gradient(45deg,var(--accent1),var(--accent2));
    border:none; color:#fff; padding:12px 22px; border-radius:12px;
    font-weight:700; cursor:pointer; transition:transform .18s, box-shadow .18s;
    box-shadow:0 8px 20px rgba(0,0,0,.35); font-size:1rem;
  }
  .btn:active{ transform:scale(.98) }
  .btn:disabled{ opacity:.5; cursor:not-allowed; transform:none; box-shadow:none; }

  #timer{
    position:fixed; top:18px; right:18px;
    background:rgba(0,0,0,.45); padding:10px 14px; border-radius:12px;
    color:#00ffff; font-weight:800; font-size:1.2rem; min-width:72px; text-align:center;
    box-shadow:0 6px 18px rgba(0,255,255,.08); z-index:1200;
  }

  main{flex:1; width:100%; max-width:1100px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:20px;}
  #numbers{
    width:100%; height:260px; display:flex; align-items:center; justify-content:center; position:relative;
  }
  .number{
    position:absolute; font-size:9.5rem; line-height:1; font-weight:900; opacity:0;
    transform:translateY(-160px) scale(.6) rotate(-12deg);
    text-shadow:6px 6px 26px rgba(0,0,0,.65);
    transition:transform .45s cubic-bezier(.2,.9,.2,1), opacity .35s ease;
    color:#fff; user-select:none;
  }
  .number.show{ transform:translateY(0) scale(1) rotate(0); opacity:1; }

  #inputArea{ display:none; gap:12px; align-items:center; justify-content:center; margin-top:8px; }
  #userAnswer{ padding:12px 14px; font-size:1.1rem; border-radius:10px; border:none; width:180px; }
  #checkBtn{
    background:linear-gradient(45deg,var(--accentBlue1),var(--accentBlue2));
    border:none; color:#fff; padding:12px 20px; border-radius:10px; font-weight:700; cursor:pointer;
  }
  #messages{ margin-top:14px; font-weight:800; font-size:1.1rem; text-align:center; }
  #messages .ok{ color:#7CFC00; }  #messages .bad{ color:#FF7B6B; }

  @media (max-width:700px){ .number{ font-size:6.2rem; } header{flex-direction:column; align-items:flex-start; gap:10px;} }
</style>
</head>
<body>

<header>
  <h1>Таланти 2025</h1>
  <div class="controls">
    <button class="btn" id="lvl1" onclick="startGame(1)">1-ва (до 10)</button>
    <button class="btn" id="lvl2" onclick="startGame(2)">2-ра (до 100)</button>
    <button class="btn" id="lvl3" onclick="startGame(3)">3-та (до 1000)</button>
  </div>
</header>

<div id="timer">—</div>

<main>
  <div id="numbers" aria-live="off"></div>

  <div id="inputArea">
    <input id="userAnswer" type="number" placeholder="Въведи отговора" />
    <button id="checkBtn" onclick="checkAnswer()">Провери</button>
  </div>

  <div id="messages"></div>
</main>

<script>
let sequence = [];
let currentSum = 0;
let index = 0;

let timerInterval = null;
let numberInterval = null;
let secondTimeout = null;

let timeUp = false;

const levelConfig = {
  1: { max:10,   secondDelay:1000, interval:2000,  timer:20  },
  2: { max:100,  secondDelay:5000, interval:5000,  timer:50  },
  3: { max:1000, secondDelay:5000, interval:10000, timer:120 }
};

const numbersEl = document.getElementById('numbers');
const timerEl = document.getElementById('timer');
const inputArea = document.getElementById('inputArea');
const userAnswer = document.getElementById('userAnswer');
const messages = document.getElementById('messages');
const btns = [document.getElementById('lvl1'), document.getElementById('lvl2'), document.getElementById('lvl3')];

function startGame(level){
  clearAll();
  timeUp = false;
  sequence = [];
  currentSum = 0;
  index = 0;
  messages.innerHTML = '';
  numbersEl.innerHTML = '';
  inputArea.style.display = 'none';
  userAnswer.value = '';
  setButtonsDisabled(true);

  const cfg = levelConfig[level];

  // Генериране на 10 числа; за 3-то ниво гарантираме крайна сума в [-1000, 1000]
  sequence = generateSequence(level, cfg.max);

  // Стартирай таймера
  startTimer(cfg.timer);

  // Първо число веднага
  showNumber(sequence[index]); index++;

  // Второ число след secondDelay, после през interval
  secondTimeout = setTimeout(()=> {
    if(timeUp) return;
    if(index < sequence.length){ showNumber(sequence[index]); index++; }
    if(!timeUp){
      numberInterval = setInterval(()=> {
        if(timeUp){ clearInterval(numberInterval); return; }
        if(index < sequence.length){
          showNumber(sequence[index]); index++;
        } else {
          clearInterval(numberInterval);
          finishSequence();
        }
      }, cfg.interval);
    }
  }, cfg.secondDelay);
}

/* Генератор на последователност */
function generateSequence(level, maxNumber){
  if(level !== 3){
    // Нива 1 и 2 – стандартно генериране
    const arr = [];
    for(let i=0;i<10;i++){
      let n = Math.floor(Math.random()*maxNumber)+1;
      if(Math.random()<0.5) n = -n;
      arr.push(n);
    }
    return arr;
  }

  // Ниво 3 – гарантираме крайна сума в [-1000, 1000]
  for(let attempt=0; attempt<200; attempt++){
    const arr = [];
    let sum = 0;

    // Първите 9 произволни
    for(let i=0;i<9;i++){
      let n = Math.floor(Math.random()*maxNumber)+1;
      if(Math.random()<0.5) n = -n;
      arr.push(n);
      sum += n;
    }

    // Определяме диапазон за 10-то число така, че финалната сума да е в [-1000,1000]
    let minNeeded = -1000 - sum;
    let maxNeeded =  1000 - sum;

    // Ограничаваме от позволения диапазон на самото число
    const minAllowed = Math.max(minNeeded, -maxNumber);
    const maxAllowed = Math.min(maxNeeded,  maxNumber);

    if(minAllowed > maxAllowed){
      // Невъзможно при тази девятка – опитай нова последователност
      continue;
    }

    // Случаен избор в [minAllowed, maxAllowed], избягваме 0 за консистентност
    let last = randomInt(minAllowed, maxAllowed);
    if(last === 0){
      if(minAllowed < 0) last = -1;
      else if(maxAllowed > 0) last = 1;
      else last = 0; // рядък случай, позволяваме 0
    }

    arr.push(last);
    const finalSum = sum + last;

    if(finalSum >= -1000 && finalSum <= 1000){
      return arr;
    }
  }

  // Резервен вариант: ако не успеем (много малко вероятно), регенерираме без условие и ще коригираме последното число към 0
  const fallback = [];
  for(let i=0;i<10;i++){
    let n = Math.floor(Math.random()*maxNumber)+1;
    if(Math.random()<0.5) n = -n;
    fallback.push(n);
  }
  return fallback;
}

function randomInt(min, max){
  min = Math.ceil(min); max = Math.floor(max);
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

/* Показване на число (с голям размер и анимация) */
function showNumber(num){
  numbersEl.innerHTML = '';
  const div = document.createElement('div');
  div.className = 'number';
  div.textContent = (num >= 0 ? '+' : '') + num;
  numbersEl.appendChild(div);
  void div.offsetWidth; // reflow за transition
  div.classList.add('show');
  currentSum += num;
}

/* Таймер */
function startTimer(seconds){
  if(timerInterval) clearInterval(timerInterval);
  let left = seconds;
  timerEl.textContent = left;
  timerInterval = setInterval(()=>{
    left--;
    if(left >= 0) timerEl.textContent = left;
    if(left <= 0){
      clearInterval(timerInterval);
      timeUp = true;
      clearAllExceptTimer();
      numbersEl.innerHTML = '';
      showInputArea();
      timerEl.textContent = 'Времето изтече!';
    }
  }, 1000);
}

/* Край при нормално приключване (преди да изтече таймерът) */
function finishSequence(){
  if(timerInterval){ clearInterval(timerInterval); timerInterval = null; }
  clearAllExceptTimer();
  showInputArea();
  timerEl.textContent = 'Готово';
}

/* Поле за отговор */
function showInputArea(){
  inputArea.style.display = 'flex';
  userAnswer.focus();
  setButtonsDisabled(false);
}

/* Проверка */
function checkAnswer(){
  const val = userAnswer.value.trim();
  if(val === ''){ messages.innerHTML = '<span class="bad">Моля, въведи число.</span>'; return; }
  const parsed = Number(val);
  if(Number.isNaN(parsed)){ messages.innerHTML = '<span class="bad">Въведи валидно число.</span>'; return; }

  if(parsed === currentSum){
    messages.innerHTML = '<span class="ok">Правилно! Резултатът е ' + currentSum + '.</span>';
  } else {
    messages.innerHTML = '<span class="bad">Грешно. Правилният резултат е ' + currentSum + '.</span>';
  }
  userAnswer.value = '';
}

/* Помощни – чистене и бутони */
function clearAll(){
  if(numberInterval){ clearInterval(numberInterval); numberInterval = null; }
  if(secondTimeout){ clearTimeout(secondTimeout); secondTimeout = null; }
  if(timerInterval){ clearInterval(timerInterval); timerInterval = null; }
}
function clearAllExceptTimer(){
  if(numberInterval){ clearInterval(numberInterval); numberInterval = null; }
  if(secondTimeout){ clearTimeout(secondTimeout); secondTimeout = null; }
}
function setButtonsDisabled(flag){ btns.forEach(b=> b.disabled = !!flag); }

/* Enter за проверка */
userAnswer.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') checkAnswer(); });

/* expose for onclick */
window.checkAnswer = checkAnswer;
</script>
</body>
</html>
