<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Таланти 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
    --accent1: #ff512f; --accent2:#dd2476; --accentBlue1:#00c6ff; --accentBlue2:#0072ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Montserrat',sans-serif;
    background: linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;
    padding:40px 20px;
    overflow:hidden;
  }

  header{
    width:100%;
    max-width:1100px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:20px;
    margin-bottom:10px;
  }

  h1{
    margin:0;
    font-size:2.2rem;
    letter-spacing:0.6px;
    text-shadow: 3px 3px 12px rgba(0,0,0,0.6);
  }

  .controls{
    display:flex;
    gap:12px;
    align-items:center;
  }

  .btn {
    background: linear-gradient(45deg,var(--accent1),var(--accent2));
    border: none;
    color: #fff;
    padding: 12px 22px;
    border-radius: 12px;
    font-weight:700;
    cursor:pointer;
    transition: transform .18s ease, box-shadow .18s ease;
    box-shadow:0 8px 20px rgba(0,0,0,0.35);
    font-size:1rem;
  }
  .btn:active{ transform: scale(.98) }
  .btn:disabled{ opacity:.5; cursor:not-allowed; transform:none; box-shadow:none; }

  /* timer box top-right (fixed) */
  #timer {
    position: fixed;
    top: 18px;
    right: 18px;
    background: rgba(0,0,0,0.45);
    padding: 10px 14px;
    border-radius: 12px;
    color: #00ffff;
    font-weight:800;
    font-size:1.2rem;
    box-shadow:0 6px 18px rgba(0,255,255,0.08);
    z-index:1200;
    text-align:center;
    min-width:72px;
  }

  /* big numbers area */
  main{
    flex:1;
    width:100%;
    max-width:1100px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:20px;
  }

  #numbers {
    width:100%;
    height:260px;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    pointer-events:none;
  }

  .number {
    position:absolute;
    font-size:9.5rem;
    line-height:1;
    font-weight:900;
    opacity:0;
    transform:translateY(-160px) scale(.6) rotate(-12deg);
    text-shadow: 6px 6px 26px rgba(0,0,0,0.65);
    transition: transform .45s cubic-bezier(.2,.9,.2,1), opacity .35s ease;
    color: #fff;
    -webkit-user-select:none;
    user-select:none;
  }

  .number.show {
    transform: translateY(0) scale(1) rotate(0);
    opacity:1;
  }

  /* small input area */
  #inputArea{
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:center;
    margin-top:8px;
  }
  #userAnswer{
    padding:12px 14px;
    font-size:1.1rem;
    border-radius:10px;
    border:none;
    width:180px;
  }
  #checkBtn{
    background: linear-gradient(45deg,var(--accentBlue1),var(--accentBlue2));
    border:none;
    color:#fff;
    padding:12px 20px;
    border-radius:10px;
    font-weight:700;
    cursor:pointer;
  }

  #messages{ margin-top:14px; font-weight:800; font-size:1.1rem; text-align:center;}
  #messages .ok{ color:#7CFC00; }
  #messages .bad{ color:#FF7B6B; }

  /* responsive */
  @media (max-width:700px){
    .number{ font-size:6.2rem; }
    header{ flex-direction:column; align-items:flex-start; gap:10px;}
  }
</style>
</head>
<body>

<header>
  <h1>Таланти 2025</h1>

  <div class="controls" aria-hidden="false">
    <button class="btn" id="lvl1" onclick="startGame(1)">1-ва (до 10)</button>
    <button class="btn" id="lvl2" onclick="startGame(2)">2-ра (до 100)</button>
    <button class="btn" id="lvl3" onclick="startGame(3)">3-та (до 1000)</button>
  </div>
</header>

<div id="timer">20</div>

<main>
  <div id="numbers" aria-live="off"></div>

  <div id="inputArea" style="display:none;">
    <input id="userAnswer" type="number" placeholder="Въведи отговора" />
    <button id="checkBtn" onclick="checkAnswer()">Провери</button>
  </div>

  <div id="messages"></div>
</main>

<script>
/* Глобални променливи за управление */
let sequence = [];
let currentSum = 0;
let index = 0;

let timerInterval = null;
let numberInterval = null;
let secondTimeout = null;

let timeUp = false;

/* Параметри по нива */
const levelConfig = {
  1: { max:10, secondDelay:1000, interval:2000, timer:20 },
  2: { max:100, secondDelay:5000, interval:5000, timer:50 },
  3: { max:1000, secondDelay:5000, interval:10000, timer:120 }
};

/* Помощни елементи */
const numbersEl = document.getElementById('numbers');
const timerEl = document.getElementById('timer');
const inputArea = document.getElementById('inputArea');
const userAnswer = document.getElementById('userAnswer');
const messages = document.getElementById('messages');
const btns = [document.getElementById('lvl1'),document.getElementById('lvl2'),document.getElementById('lvl3')];

/* Функция — стартира игра за дадено ниво */
function startGame(level){
  // изчисти предишни
  clearAllIntervalsAndTimeouts();
  timeUp = false;
  sequence = [];
  currentSum = 0;
  index = 0;
  messages.innerHTML = '';
  numbersEl.innerHTML = '';
  inputArea.style.display = 'none';
  userAnswer.value = '';

  // деактивирай бутоните докато тече играта
  setButtonsDisabled(true);

  const cfg = levelConfig[level];

  // генериране на 10 числа
  for(let i=0;i<10;i++){
    let n = Math.floor(Math.random()*cfg.max) + 1;
    if(Math.random() < 0.5) n = -n;
    sequence.push(n);
  }

  // стартирай таймер (по секундите от конфигурацията)
  startTimer(cfg.timer);

  // покажи първо число веднага, второ след secondDelay, после редовен interval
  showNumberImmediate(sequence[index]);
  index++;

  // втората пауза (secondDelay)
  secondTimeout = setTimeout(()=> {
    if(timeUp) return;
    if(index < sequence.length){
      showNumberImmediate(sequence[index]);
      index++;
    }
    // започваме редовния интервал само ако все още има числа и времето не е изтекло
    if(!timeUp){
      numberInterval = setInterval(()=> {
        if(timeUp){
          clearInterval(numberInterval);
          return;
        }
        if(index < sequence.length){
          showNumberImmediate(sequence[index]);
          index++;
        } else {
          // всички числа показани по нормален начин
          clearInterval(numberInterval);
          finishSequence();
        }
      }, cfg.interval);
    }
  }, cfg.secondDelay);
}

/* Показва число в центъра (анимирано), маха старото */
function showNumberImmediate(num){
  // махни старото
  numbersEl.innerHTML = '';

  // създай елемент
  const div = document.createElement('div');
  div.className = 'number';
  const sign = num >= 0 ? '+' : '';
  div.textContent = sign + num;
  numbersEl.appendChild(div);

  // force reflow за да приложим transition
  void div.offsetWidth;
  div.classList.add('show');

  // добави към сумата
  currentSum += num;
}

/* Стартира визуален таймер (секунди) */
function startTimer(seconds){
  // изчисти при вече имащ
  if(timerInterval) clearInterval(timerInterval);
  let left = seconds;
  timerEl.textContent = left;
  timerInterval = setInterval(()=>{
    left--;
    if(left >= 0) timerEl.textContent = left;
    if(left <= 0){
      clearInterval(timerInterval);
      timeUp = true;
      // спрени интервали/таймаути за показване на числа
      clearAllIntervalsAndTimeouts();
      // махаме текущото число и показваме полето за отговор
      numbersEl.innerHTML = '';
      showInputArea();
      timerEl.textContent = 'Времето изтече!';
    }
  },1000);
}

/* Показване на полето за подаване на отговор и активиране на бутоните */
function showInputArea(){
  inputArea.style.display = 'flex';
  userAnswer.focus();
  setButtonsDisabled(false);
}

/* Когато всички числа са показани преди таймера */
function finishSequence(){
  clearInterval(timerInterval);
  // спрени интервали/таймаути
  clearAllIntervalsAndTimeouts();
  showInputArea();
  timerEl.textContent = 'Готово';
}

/* Проверка на отговора (натиснат бутон или Enter) */
function checkAnswer(){
  const val = userAnswer.value.trim();
  if(val === ''){
    messages.innerHTML = '<span class="bad">Моля въведи число.</span>';
    return;
  }
  const parsed = Number(val);
  if(Number.isNaN(parsed)){
    messages.innerHTML = '<span class="bad">Въведи валидно число.</span>';
    return;
  }
  if(parsed === currentSum){
    messages.innerHTML = '<span class="ok">Правилно! Резултатът е ' + currentSum + '.</span>';
  } else {
    messages.innerHTML = '<span class="bad">Грешно. Правилният резултат е ' + currentSum + '.</span>';
  }
  userAnswer.value = '';
  // след проверка може да оставим бутоните активни за нов опит
}

/* Помощни: спира всички интервали и таймаути (numberInterval, secondTimeout, timerInterval) */
function clearAllIntervalsAndTimeouts(){
  if(numberInterval){ clearInterval(numberInterval); numberInterval = null; }
  if(secondTimeout){ clearTimeout(secondTimeout); secondTimeout = null; }
  if(timerInterval){ clearInterval(timerInterval); timerInterval = null; }
}

/* Деактивира/активира бутоните за нива */
function setButtonsDisabled(flag){
  btns.forEach(b=> b.disabled = !!flag);
}

/* Enter key -> проверка */
userAnswer.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter') checkAnswer();
});

/* Направи проверката достъпна глобално за onclick */
window.checkAnswer = checkAnswer;

/* Край на скрипта */
</script>
</body>
</html>
